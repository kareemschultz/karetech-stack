module.exports = {
  // Browser configuration
  browser: {
    headless: process.env.CI ? true : 'new',
    slowMo: process.env.CI ? 0 : 50,
    devtools: !process.env.CI,
    args: [
      '--no-sandbox',
      '--disable-setuid-sandbox',
      '--disable-dev-shm-usage',
      '--disable-background-timer-throttling',
      '--disable-backgrounding-occluded-windows',
      '--disable-renderer-backgrounding',
      '--disable-extensions',
      '--disable-features=TranslateUI',
      '--disable-ipc-flooding-protection',
    ],
    defaultViewport: {
      width: 1280,
      height: 720,
    },
  },

  // Test configuration
  test: {
    baseUrl: process.env.PUPPETEER_BASE_URL || 'http://localhost:5173',
    timeout: 30000,
    retries: process.env.CI ? 2 : 0,
  },

  // Screenshot configuration
  screenshots: {
    mode: 'only-on-failure',
    path: './test-results/screenshots',
    fullPage: false,
  },

  // Video recording
  video: {
    enabled: process.env.CI || false,
    path: './test-results/videos',
  },

  // Environment setup
  environment: {
    <% if (database !== 'none') { %>DATABASE_URL: process.env.TEST_DATABASE_URL || '<%= database === 'sqlite' ? './test.db' : database === 'postgresql' ? 'postgresql://postgres:password@localhost:5432/test_db' : 'file:test.db' %>',<% } %>
    <% if (auth.length > 0) { %>BETTER_AUTH_SECRET: 'test-secret-key-puppeteer',
    BETTER_AUTH_URL: process.env.PUPPETEER_BASE_URL || 'http://localhost:5173',<% } %>
  },

  // Reporting
  reports: {
    html: './test-results/puppeteer-report.html',
    json: './test-results/puppeteer-results.json',
  },
}