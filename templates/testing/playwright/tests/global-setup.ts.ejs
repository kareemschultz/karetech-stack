import { chromium, FullConfig } from '@playwright/test'
<% if (database !== 'none') { %>import { execSync } from 'child_process'<% } %>

async function globalSetup(config: FullConfig) {
  console.log('üîß Setting up global test environment...')

  <% if (database !== 'none') { %>// Setup test database
  try {
    console.log('üìä Setting up test database...')
    <% if (database === 'postgresql') { %>process.env.DATABASE_URL = 'postgresql://postgres:password@localhost:5432/<%= projectName.toLowerCase().replace(/[^a-z0-9]/g, '_') %>_test'<% } %>
    <% if (database === 'sqlite') { %>process.env.DATABASE_URL = './test.db'<% } %>
    <% if (database === 'turso') { %>process.env.DATABASE_URL = process.env.TEST_DATABASE_URL || 'file:test.db'<% } %>

    // Run database migrations
    execSync('bun db:generate', { stdio: 'inherit' })
    execSync('bun db:migrate', { stdio: 'inherit' })

    console.log('‚úÖ Test database setup complete')
  } catch (error) {
    console.error('‚ùå Failed to setup test database:', error)
    throw error
  }

  <% } %><% if (auth.length > 0) { %>// Setup test authentication
  process.env.BETTER_AUTH_SECRET = 'test-secret-key-for-e2e-tests'
  process.env.BETTER_AUTH_URL = config.webServer?.url || 'http://localhost:5173'

  <% } %>// Launch a browser to warm up for faster test execution
  const browser = await chromium.launch()
  await browser.close()

  console.log('üöÄ Global setup complete!')
}

export default globalSetup