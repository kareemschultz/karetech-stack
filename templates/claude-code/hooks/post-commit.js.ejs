#!/usr/bin/env bun
/**
 * Claude Code Post-commit Hook for <%= projectName %>
 * Updates Beads tracking after successful commits
 * Generated by create-karetech-stack
 */

<% if (beadsIntegration) { %>
console.log('ğŸ“‹ Updating Beads tracking...');

try {
  // Get the commit message to check for issue references
  const commitMsg = await $`git log -1 --pretty=%B`.text();

  // Check for issue references (bd-XXXX pattern or project-specific pattern)
  const issueMatch = commitMsg.match(/<%= projectName.toLowerCase().replace(/[^a-z0-9]/g, '-') %>-([a-zA-Z0-9]+)/);

  if (issueMatch) {
    const issueId = '<%= projectName.toLowerCase().replace(/[^a-z0-9]/g, '-') %>-' + issueMatch[1];
    console.log(`ğŸ“Œ Found issue reference: ${issueId}`);

    // Update issue with commit reference
    const commitHash = await $`git rev-parse --short HEAD`.text();
    await $`bd update ${issueId} --comment "Commit: ${commitHash.trim()}"`;
    console.log('âœ… Issue updated with commit reference');
  }

  // Sync all tracking
  await $`bd sync`;
  console.log('âœ… Beads tracking synchronized');

} catch (error) {
  console.warn('âš ï¸  Post-commit Beads sync failed:', error.message);
  // Don't fail the commit for tracking issues
}
<% } else { %>
// Beads integration not enabled for this project
console.log('â„¹ï¸  Post-commit hook ready (Beads not configured)');
<% } %>
