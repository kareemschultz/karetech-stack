import { createRootRoute, Link, Outlet } from '@tanstack/react-router'
import { TanStackRouterDevtools } from '@tanstack/router-devtools'<% if (analytics === 'posthog') { %>
import { useEffect } from 'react'
import posthog from 'posthog-js'<% } %><% if (auth.length > 0) { %>
import { AuthProvider } from '@/components/auth/auth-provider'<% } %>

export const Route = createRootRoute({
  component: () => (
    <<% if (auth.length > 0) { %>AuthProvider<% } else { %>div<% } %>>
      <div className="p-2 flex gap-2">
        <Link to="/" className="[&.active]:font-bold">
          Home
        </Link>
        <Link to="/about" className="[&.active]:font-bold">
          About
        </Link><% if (auth.includes('email') || auth.includes('github') || auth.includes('google') || auth.includes('discord') || auth.includes('microsoft')) { %>
        <Link to="/auth" className="[&.active]:font-bold">
          Auth
        </Link><% } %>
      </div>
      <hr />
      <AppContent />
    </<% if (auth.length > 0) { %>AuthProvider<% } else { %>div<% } %>>
  ),
})

function AppContent() {<% if (analytics === 'posthog') { %>
  useEffect(() => {
    // Track page views with PostHog
    const handleRouteChange = () => {
      if (typeof window !== 'undefined' && posthog) {
        posthog.capture('$pageview')
      }
    }

    // Track initial page view
    handleRouteChange()

    // Listen for route changes
    window.addEventListener('popstate', handleRouteChange)

    return () => {
      window.removeEventListener('popstate', handleRouteChange)
    }
  }, [])<% } %>

  return (
    <>
      <Outlet />
      {import.meta.env.DEV && <TanStackRouterDevtools />}
    </>
  )
}